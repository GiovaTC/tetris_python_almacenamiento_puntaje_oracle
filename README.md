# tetris_python_almacenamiento_puntaje_oracle :

<img width="203" height="193" alt="image" src="https://github.com/user-attachments/assets/acd0ce8a-579d-497b-a76e-797430d0bb13" />  

# Tetris en python con almacenamiento de puntaje en Oracle :

<img width="2553" height="1079" alt="image" src="https://github.com/user-attachments/assets/ce901ac9-fe5d-4164-b5a3-f6de73d12de9" />

este documento incluye :

- codigo completo: `tetris_oracle.py` (juego Tetris con Pygame) .  
- DDL para crear la tabla en oracle .  
- `requirements.txt` e instrucciones para ejecutar .  
- manejo de errores : si la conexión a oracle falla, el puntaje se guarda en `scores.csv` como respaldo .  

---

## 1) Dependencias :

Crea un **virtualenv** y luego instala :

### requirements.txt :

```txt
pygame>=2.1
oracledb>=1.0
python-dotenv>=1.0

Instalacion rapida
bash

python -m venv venv
source venv/bin/activate   # Linux / macOS
venv\Scripts\activate      # Windows
pip install -r requirements.txt

2) DDL Oracle :

CREATE TABLE tetris_scores (
  id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  player VARCHAR2(100) NOT NULL,
  score NUMBER NOT NULL,
  lines_cleared NUMBER NOT NULL,
  level NUMBER NOT NULL,
  played_at TIMESTAMP DEFAULT SYSTIMESTAMP
);

-- Privilegios necesarios: INSERT en la tabla y conexión al esquema .
3) Configuración de conexion :
el script lee las siguientes variables de entorno (puedes usar un archivo .env) :
ORACLE_USER - usuario de la base de datos
ORACLE_PASSWORD - contraseña
ORACLE_DSN - string de conexión (ejemplo: host:port/service_name)

Ejemplo .env:
ORACLE_USER=tetris_user
ORACLE_PASSWORD=secret
ORACLE_DSN=localhost:1521/XEPDB1

👉 Si no deseas usar variables de entorno, edita directamente la función get_oracle_conn() en el codigo . 

4) Lógica de guardado (comportamiento) :
Al finalizar una partida, el juego intentará insertar el registro en la tabla Oracle tetris_scores .
Si la inserción en Oracle tiene éxito: se confirma y se imprime confirmación en consola .
Si falla la conexión o la inserción: se escribe una fila en scores.csv (se crea cabecera si no existe) con los campos :

pgsql
player, score, lines_cleared, level, played_at

5) Código: tetris_oracle.py :
python

#!/usr/bin/env python3

def draw_grid(screen, game, font):
    for y in range(ROWS):
        for x in range(COLUMNS):
            val = game.grid[y][x]
            rect = pygame.Rect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE)
            if val:
                color = COLORS[(val - 1) % len(COLORS)]
                pygame.draw.rect(screen, color, rect)
                pygame.draw.rect(screen, (0, 0, 0), rect, 1)
            else:
                pygame.draw.rect(screen, (30, 30, 30), rect, 1)

    # pieza actual
    for dy, row in enumerate(game.current.shape):
        for dx, cell in enumerate(row):
            if cell:
                x = (game.current.x + dx) * CELL_SIZE
                y = (game.current.y + dy) * CELL_SIZE
                rect = pygame.Rect(x, y, CELL_SIZE, CELL_SIZE)
                pygame.draw.rect(screen, game.current.color, rect)
                pygame.draw.rect(screen, (0, 0, 0), rect, 1)

    # UI texto
    info_x = 10
    text_surface = font.render(f'Score: {game.score}', True, (255, 255, 255))
    screen.blit(text_surface, (info_x, HEIGHT - 70))
    text_surface = font.render(f'Lines: {game.lines}', True, (255, 255, 255))
    screen.blit(text_surface, (info_x + 150, HEIGHT - 70))
    text_surface = font.render(f'Level: {game.level}', True, (255, 255, 255))
    screen.blit(text_surface, (info_x + 300, HEIGHT - 70))

def main():
    pygame.init()
    screen = pygame.display.set_mode((WIDTH, HEIGHT))
    pygame.display.set_caption('Tetris - Guarda puntaje en Oracle')
    clock = pygame.time.Clock()
    font = pygame.font.SysFont('dejavusans', 20)

    game = Tetris()

    fall_event = pygame.USEREVENT + 1
    pygame.time.set_timer(fall_event, game.fall_speed)

    player_name = 'Player'

    running = True
    while running:
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                running = False

            elif event.type == pygame.KEYDOWN:
                if event.key == pygame.K_LEFT:
                    if game.valid(game.current.shape, game.current.x - 1, game.current.y):
                        game.current.x -= 1
                elif event.key == pygame.K_RIGHT:
                    if game.valid(game.current.shape, game.current.x + 1, game.current.y):
                        game.current.x += 1
                elif event.key == pygame.K_DOWN:
                    game.soft_drop()
                elif event.key == pygame.K_UP:
                    original = [row[:] for row in game.current.shape]
                    game.current.rotate()
                    if not game.valid(game.current.shape, game.current.x, game.current.y):
                        game.current.shape = original
                elif event.key == pygame.K_SPACE:
                    game.hard_drop()
                elif event.key == pygame.K_n:
                    game = Tetris()
                elif event.key == pygame.K_s:
                    try:
                        print('Ingresa nombre del jugador (en la consola): ')
                        name = input().strip()
                        if name:
                            player_name = name
                    except Exception:
                        pass

            elif event.type == fall_event:
                pygame.time.set_timer(fall_event, game.fall_speed)
                if not game.game_over:
                    game.soft_drop()

        screen.fill((10, 10, 10))
        draw_grid(screen, game, font)

        if game.game_over:
            big = pygame.font.SysFont('dejavusans', 36)
            surf = big.render('GAME OVER - Press N to start new game', True, (255, 0, 0))
            screen.blit(surf, (20, HEIGHT // 2 - 20))
            if not getattr(game, '_score_persisted', False):
                persist_score(player_name, game.score, game.lines, game.level)
                game._score_persisted = True

        pygame.display.flip()
        clock.tick(FPS)

    pygame.quit()
